<script src="https://d3js.org/d3.v5.js"></script>

<script src="https://d3js.org/d3-array.v1.min.js"></script>
<script src="https://d3js.org/d3-collection.v1.min.js"></script>
<script src="https://d3js.org/d3-color.v1.min.js"></script>
<script src="https://d3js.org/d3-format.v1.min.js"></script>
<script src="https://d3js.org/d3-interpolate.v1.min.js"></script>
<script src="https://d3js.org/d3-time.v1.min.js"></script>
<script src="https://d3js.org/d3-time-format.v2.min.js"></script>
<script src="https://d3js.org/d3-scale.v2.min.js"></script>

<!-- <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script> -->

<script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>

<html>

<head>
    <meta charset="utf-8">
    <style>
        body {
            font: 10px sans-serif;
        }
        
        .axis path,
        .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }
        
        .bar {
            fill: orange;
        }
        
        .bar:hover {
            fill: orangered;
        }
        
        .x.axis path {
            display: none;
        }
        
        .d3-tip {
            line-height: 1;
            font-weight: bold;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
        }
        /* Creates a small triangle extender for the tooltip */
        
        .d3-tip:after {
            box-sizing: border-box;
            display: inline;
            font-size: 10px;
            width: 100%;
            line-height: 1;
            color: rgba(0, 0, 0, 0.8);
            content: "\25BC";
            position: absolute;
            text-align: center;
        }
        /* Style northward tooltips differently */
        
        .d3-tip.n:after {
            margin: -1px 0 0 0;
            top: 100%;
            left: 0;
        }
    </style>
</head>


<body>
    <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.6/d3.min.js"></script>

    <script src="http://labratrevenge.com/d3-tip/javascripts/d3.tip.v0.6.3.js"></script>


    <h1 style="font-size:30px">
        Budget Plan on education
    </h1>
    <p style="font-size:20px">
        The government delivered the budget plan for 2018-2019 on Feb 28. Despite the annual increasing in the devotion of education resources, Hong Kong government announced to ditribute 10 thousand of Ocean Park tickets to the students. They also proposed to
        give thousand of money per person to the DSE candidates. The new policy and the budget plan on education attracts the public's attention. Though the welfare is weird to some extent, the data told us that government pays more attention on the education
        in recent years.Divided into 6 parts concerning the education level, it is apparently seen that governments mainly pay on secondary school education and other education services takes up the least.
    </p>
    <script>
        var margin = {
                top: 40,
                right: 20,
                bottom: 30,
                left: 80
            },
            width = 960 - margin.left - margin.right,
            height = 550 - margin.top - margin.bottom;

        var formatPercent = d3.format(",d");

        var x = d3.scale.ordinal()
            .rangeRoundBands([0, width], .1);

        var y = d3.scale.linear()
            .range([height, 0]);

        var xAxis = d3.svg.axis()
            .scale(x)
            .orient("bottom");

        var yAxis = d3.svg.axis()
            .scale(y)
            .orient("left")
            .tickFormat(formatPercent);

        var tip = d3.tip()
            .attr('class', 'd3-tip')
            .offset([-10, 0])
            .html(function(d) {
                return "<strong>Value:</strong> <span style='color:red'>" + d.value + "</span>";
            })

        var svg = d3.select("body").append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        svg.call(tip);

        d3.csv("data.csv", type, function(error, data) {
            x.domain(data.map(function(d) {
                return d.name;
            }));
            y.domain([0, d3.max(data, function(d) {
                return d.value;
            })]);

            svg.append("g")
                .attr("class", "x axis")
                .attr("transform", "translate(0," + height + ")")
                .call(xAxis);

            svg.append("g")
                .attr("class", "y axis")
                .call(yAxis)
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", ".71em")
                .style("text-anchor", "end")
                .text("Value");

            svg.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .attr("x", function(d) {
                    return x(d.name);
                })
                .attr("width", x.rangeBand())
                .attr("y", function(d) {
                    return y(d.value);
                })
                .attr("height", function(d) {
                    return height - y(d.value);
                })
                .on('mouseover', tip.show)
                .on('mouseout', tip.hide)

        });

        function type(d) {
            d.value = +d.value;
            return d;
        }
    </script>


    <div>
        <svg>
    <text x=10 y=10></text>
      </svg>
        <p style="font-size:20px">
            The most obvious one can be the increasement in the post-secondary education. In 2017-2018, according to the budget,t he money distribution should be 3390.9 million, while in 2018-2019 it turns to be 5245.6 million rapidly.
        </p>
        <style>
            svg {
                width: 1000px;
                height: 750px;
            }
        </style>

        <script>
            var x = d3.scaleLinear()
                .domain([0, 600])
                .range([0, 600]);
            // var x = d3.scale.ordinal()
            //     .domain(["pre-primary education", "primary education", "secondary education", "special education", "other education services", "post-secondary,vocational and professional educayion"])
            //     .rangePoints([0, width]);
            var y = d3.scaleLinear()
                .domain([0, 30000])
                .range([700, 0]);

            var xAxis = d3.axisBottom().scale(x);

            var yAxis = d3.axisLeft().scale(y);

            var svg = d3.select('svg');


            svg.append('g')
                .attr('transform', 'translate(50,700)')
                .call(xAxis);

            svg.append('g')
                .attr('transform', 'translate(50,0)')
                .call(yAxis);



            var dataset = [
                [2016, [{
                    "name": "pre-primary education",
                    "width": 100,
                    "value": 3484.3,
                }, {
                    "name": "primary education",
                    "width": 200,
                    "value": 16382.5,
                }, {
                    "name": "secondary education",
                    "width": 300,
                    "value": 25102.8,
                }, {
                    "name": "special education",
                    "width": 400,
                    "value": 2309.5,
                }, {
                    "name": "other education services",
                    "width": 500,
                    "value": 902.7,
                }, {
                    "name": "post-secondary,vocational and professional educayion",
                    "width": 600,
                    "value": 3006.5,
                }, ]],
                [2017, [{
                    "name": "pre-primary education",
                    "width": 100,
                    "value": 5282.2,
                }, {
                    "name": "primary education",
                    "width": 200,
                    "value": 17367.8,
                }, {
                    "name": "secondary education",
                    "width": 300,
                    "value": 24341.9,
                }, {
                    "name": "special education",
                    "width": 400,
                    "value": 2451.6,
                }, {
                    "name": "other education services",
                    "width": 500,
                    "value": 952.2,
                }, {
                    "name": "post-secondary,vocational and professional educayion",
                    "width": 600,
                    "value": 3390.9,
                }, ]],
                [2018, [{
                    "name": "pre-primary education",
                    "width": 100,
                    "value": 5995.7,
                }, {
                    "name": "primary education",
                    "width": 200,
                    "value": 19228.9,
                }, {
                    "name": "secondary education",
                    "width": 300,
                    "value": 27305.7,
                }, {
                    "name": "special education",
                    "width": 400,
                    "value": 2726.6,
                }, {
                    "name": "other education services",
                    "width": 500,
                    "value": 1038.6,
                }, {
                    "name": "post-secondary,vocational and professional educayion",
                    "width": 600,
                    "value": 5245.6,
                }, ]],
            ]


            var frameHeight = 700;

            svg
                .selectAll('circle')
                .data(dataset[0][1])
                .enter()
                .append('circle')
                .attr('cx', function(d) {
                    return x(d["width"]);
                })
                .attr('cy', function(d) {

                    return y((frameHeight + d["value"]));
                })
                .attr('r', function(d) {
                    return Math.sqrt(d["value"]) / 3;
                })
                .attr('fill', '#ff0000');



            var keySnapshot = 0;
            d3.interval(function() {
                keySnapshot = (keySnapshot + 1) % dataset.length;
                svg
                    .selectAll('circle')
                    .data(dataset[1][1])
                    .transition()
                    .duration(500)

                .attr('cx', function(d) {
                        return x(d["width"]);
                    })
                    .attr('cy', function(d) {

                        return y((frameHeight + d["value"]));
                    })
                    .attr('r', function(d) {
                        return Math.sqrt(d["value"]) / 3;
                    })
                    .attr("fill", "steelblue")
            }, 700)

            var keySnapshot = 0;
            d3.interval(function() {
                keySnapshot = (keySnapshot + 1) % dataset.length;
                svg
                    .selectAll('circle')
                    .data(dataset[2][1])
                    .transition()
                    .duration(500)

                .attr('cx', function(d) {
                        return x(d["width"]);
                    })
                    .attr('cy', function(d) {

                        return y((frameHeight + d["value"]));
                    })
                    .attr('r', function(d) {
                        return Math.sqrt(d["value"]) / 3;
                    })
                    .attr("fill", "green")
            }, 700)
        </script>
    </div>
</body>

</html>
